<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #header {
            min-height: 60px;
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 2000;
            position: relative;
            flex-shrink: 0;
        }
        .header-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-logo {
            height: 45px;
            width: auto;
        }
        .header-title {
            display: flex;
            flex-direction: column;
        }
        .header-title .sub-title {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.1;
        }
        .header-title h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
            letter-spacing: 0.5px;
            line-height: 1.1;
        }
        #about-btn, #legend-btn {
            background-color: #f8f9fa;
            color: #1e3c72;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        #about-btn:hover, #legend-btn:hover {
            background-color: #e2e6ea;
        }
        #header-buttons {
            display: flex;
            gap: 10px; /* Space between buttons */
        }
        #map {
            width: 100%;
            flex-grow: 1;
            padding: 0;
            margin: 0;
        }
        /* Customizing Leaflet Controls */
        .leaflet-control-layers, .leaflet-bar, .leaflet-control-measure, .leaflet-control-search {
            border: none !important;
            border-radius: 5px !important;
            box-shadow: none !important;
        }
        .leaflet-control-layers {
            box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
        }
        /* Unified button style for all controls */
        .leaflet-bar a, 
        .leaflet-control-measure-toggle, 
        .gcd-gl-btn {
            width: 34px !important;
            height: 34px !important;
            line-height: 34px !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            background-color: #fff !important;
            color: #444 !important;
            border-bottom: 1px solid #eee !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
            border-radius: 5px !important;
            font-size: 16px !important;
            text-decoration: none !important;
            cursor: pointer;
            transition: all 0.2s ease;
            text-indent: 0 !important; /* Fix for measure control */
            background-image: none !important; /* Fix for measure control */
        }
        .leaflet-bar a:hover, 
        .leaflet-control-measure-toggle:hover, 
        .gcd-gl-btn:hover {
            background-color: #f4f4f4 !important;
            color: #1e3c72 !important;
        }
        /* Fix grouping for zoom control */
        .leaflet-bar a {
            border-radius: 0 !important;
            box-shadow: none !important;
        }
        .leaflet-bar a:first-child {
            border-top-left-radius: 5px !important;
            border-top-right-radius: 5px !important;
        }
        .leaflet-bar a:last-child {
            border-bottom-left-radius: 5px !important;
            border-bottom-right-radius: 5px !important;
            border-bottom: none !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
        }
        /* Popup Styling */
        .leaflet-popup-content-wrapper {
            border-radius: 12px !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2) !important;
            padding: 5px !important;
        }
        .leaflet-popup-content {
            margin: 10px 15px !important;
            font-size: 14px;
            line-height: 1.6;
            max-height: 300px !important;
            min-width: 200px;
            overflow: auto !important;
        }
        .leaflet-popup-tip {
            box-shadow: 0 10px 25px rgba(0,0,0,0.2) !important;
        }
        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 3000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: animatetop 0.4s;
        }
        /* Add Animation */
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content h2 {
            margin-top: 0;
            color: #2a5298;
        }
        .modal-content p, .modal-content ul {
            font-size: 15px;
            line-height: 1.7;
        }
        .modal-content ul {
            list-style-type: none;
            padding: 0;
        }
        .modal-content ul li {
            margin-bottom: 10px;
        }
        #legend-modal {
            overflow: hidden;
        }
        #legend-modal .modal-content img {
            max-width: 100%;
            height: auto;
            max-height: 60vh;
            object-fit: contain;
        }
        #legend-modal .modal-content {
            text-align: center;
            margin: 5% auto;
            overflow: hidden;
        }
        .download-btn {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #1e3c72;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .download-btn:hover {
            background-color: #2a5298;
        }
        /* Search Input Styling */
        .photon-input {
            height: 34px !important;
            border: none !important;
            border-radius: 0 5px 5px 0 !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
            padding: 0 12px !important;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            outline: none;
            width: 220px !important;
        }
        .leaflet-control-search.active .gcd-gl-btn {
            border-top-right-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            #header {
                flex-direction: column;
                padding: 10px 20px;
                gap: 10px;
            }
            .header-brand {
                flex-direction: column;
                gap: 5px;
            }
            .header-title {
                align-items: center;
                text-align: center;
                width: 100%;
            }
            #header-buttons {
                width: 100%;
                justify-content: center;
            }
            #about-btn, #legend-btn {
                flex: 1;
                text-align: center;
            }
            .photon-input {
                width: 150px !important;
            }
            .modal-content {
                width: 90%;
                margin: 20% auto;
            }
        }
        </style>
        <title>Peta Kawasan Hutan - Kabupaten Pasangkayu</title>
    </head>
    <body>
        <div id="header">
            <div class="header-brand">
                <img src="images/logo_west_sulawesi.png" alt="Logo Sulawesi Barat" class="header-logo">
                <div class="header-title">
                    <span class="sub-title">Peta Kawasan Hutan</span>
                    <h1>Kabupaten Pasangkayu</h1>
                </div>
            </div>
            <div id="header-buttons">
                <button id="legend-btn"><i class="fas fa-map"></i> Legenda</button>
                <button id="about-btn"><i class="fas fa-info-circle"></i> Tentang</button>
            </div>
        </div>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/Clipped_1.js"></script>
        <script src="data/Dissolved_2.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        })
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('Hak Cipta &copy; <a href="https://aidilham21.github.io/CV-aidil/" target="_blank">Muh. Aidil Ilham</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
            if (bounds_group.getLayers().length) {
                map.fitBounds(bounds_group.getBounds());
            }
            map.setMaxBounds(map.getBounds());
            map.setMinZoom(map.getZoom());
        }
        map.createPane('pane_GoogleMaps_0');
        map.getPane('pane_GoogleMaps_0').style.zIndex = 400;
        var layer_GoogleMaps_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleMaps_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 18
        });
        layer_GoogleMaps_0;
        map.addLayer(layer_GoogleMaps_0);
        function pop_Clipped_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fcode'] !== null ? autolinker.link(String(feature.properties['fcode']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['metadata'] !== null ? autolinker.link(String(feature.properties['metadata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['srs_id'] !== null ? autolinker.link(String(feature.properties['srs_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['namobj'] !== null ? autolinker.link(String(feature.properties['namobj']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['remark'] !== null ? autolinker.link(String(feature.properties['remark']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['no_reg'] !== null ? autolinker.link(String(feature.properties['no_reg']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kode_prov'] !== null ? autolinker.link(String(feature.properties['kode_prov']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fungsikws'] !== null ? autolinker.link(String(feature.properties['fungsikws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['noskkws'] !== null ? autolinker.link(String(feature.properties['noskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tglskkws'] !== null ? autolinker.link(String(feature.properties['tglskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['lskkws'] !== null ? autolinker.link(String(feature.properties['lskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['st_area_sh'] !== null ? autolinker.link(String(feature.properties['st_area_sh']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['st_length_'] !== null ? autolinker.link(String(feature.properties['st_length_']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Keterangan</th>\
                        <td>' + (feature.properties['Keterangan'] !== null ? autolinker.link(String(feature.properties['Keterangan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Clipped_1_0(feature) {
            switch(String(feature.properties['Keterangan'])) {
                case 'Areal Penggunaan Lain':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,127,0,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Lindung':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(178,223,138,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(51,160,44,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi Konversi':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(41,213,58,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi Terbatas':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(190,207,80,1.0)',
                interactive: true,
            }
                    break;
                case 'Laut / Sungai / Badan Air':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(31,120,180,1.0)',
                interactive: true,
            }
                    break;
                case 'Taman Nasional':
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,220,193,1.0)',
                interactive: true,
            }
                    break;
                default:
                    return {
                pane: 'pane_Clipped_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(209,35,192,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Clipped_1');
        map.getPane('pane_Clipped_1').style.zIndex = 401;
        map.getPane('pane_Clipped_1').style['mix-blend-mode'] = 'normal';
        var layer_Clipped_1 = new L.geoJson(json_Clipped_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Clipped_1',
            layerName: 'layer_Clipped_1',
            pane: 'pane_Clipped_1',
            onEachFeature: pop_Clipped_1,
            style: style_Clipped_1_0,
        });
        bounds_group.addLayer(layer_Clipped_1);
        map.addLayer(layer_Clipped_1);
        function pop_Dissolved_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fcode'] !== null ? autolinker.link(String(feature.properties['fcode']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['metadata'] !== null ? autolinker.link(String(feature.properties['metadata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['srs_id'] !== null ? autolinker.link(String(feature.properties['srs_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['namobj'] !== null ? autolinker.link(String(feature.properties['namobj']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['remark'] !== null ? autolinker.link(String(feature.properties['remark']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['no_reg'] !== null ? autolinker.link(String(feature.properties['no_reg']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kode_prov'] !== null ? autolinker.link(String(feature.properties['kode_prov']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fungsikws'] !== null ? autolinker.link(String(feature.properties['fungsikws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['noskkws'] !== null ? autolinker.link(String(feature.properties['noskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tglskkws'] !== null ? autolinker.link(String(feature.properties['tglskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['lskkws'] !== null ? autolinker.link(String(feature.properties['lskkws']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['st_area_sh'] !== null ? autolinker.link(String(feature.properties['st_area_sh']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['st_length_'] !== null ? autolinker.link(String(feature.properties['st_length_']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Keterangan</th>\
                        <td>' + (feature.properties['Keterangan'] !== null ? autolinker.link(String(feature.properties['Keterangan']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kode_kec'] !== null ? autolinker.link(String(feature.properties['kode_kec']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kode_kk'] !== null ? autolinker.link(String(feature.properties['kode_kk']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kode_pro'] !== null ? autolinker.link(String(feature.properties['kode_pro']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">kecamata</th>\
                        <td>' + (feature.properties['kecamata'] !== null ? autolinker.link(String(feature.properties['kecamata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['kab_kota'] !== null ? autolinker.link(String(feature.properties['kab_kota']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['provinsi'] !== null ? autolinker.link(String(feature.properties['provinsi']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid_2'] !== null ? autolinker.link(String(feature.properties['fid_2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['nama'] !== null ? autolinker.link(String(feature.properties['nama']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['label'] !== null ? autolinker.link(String(feature.properties['label']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Dissolved_2_0(feature) {
            switch(String(feature.properties['Keterangan'])) {
                case 'Areal Penggunaan Lain':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,127,0,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Lindung':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(178,223,138,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(51,160,44,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi Konversi':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(41,213,58,1.0)',
                interactive: true,
            }
                    break;
                case 'Hutan Produksi Terbatas':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(190,207,80,1.0)',
                interactive: true,
            }
                    break;
                case 'Laut / Sungai / Badan Air':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(31,120,180,1.0)',
                interactive: true,
            }
                    break;
                case 'Taman Nasional':
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,220,193,1.0)',
                interactive: true,
            }
                    break;
                default:
                    return {
                pane: 'pane_Dissolved_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(209,35,192,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Dissolved_2');
        map.getPane('pane_Dissolved_2').style.zIndex = 402;
        map.getPane('pane_Dissolved_2').style['mix-blend-mode'] = 'normal';
        var layer_Dissolved_2 = new L.geoJson(json_Dissolved_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Dissolved_2',
            layerName: 'layer_Dissolved_2',
            pane: 'pane_Dissolved_2',
            onEachFeature: pop_Dissolved_2,
            style: style_Dissolved_2_0,
        });
        bounds_group.addLayer(layer_Dissolved_2);
        map.addLayer(layer_Dissolved_2);
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";

        // Create the new button element
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";
        
        // Prevent map click propagation
        L.DomEvent.disableClickPropagation(button);

        // Insert the button at the beginning of the search control
        search.insertBefore(button, search.firstChild);
        var input = search.querySelector('.photon-input');
        input.style.display = "none";
        L.DomEvent.disableClickPropagation(input);

        button.addEventListener("click", function (e) {
            L.DomEvent.stop(e);
            var parent = this.parentNode;
            if (input.style.display === "none") {
                input.style.display = "block";
                parent.classList.add("active");
                input.focus();
            } else {
                input.style.display = "none";
                parent.classList.remove("active");
            }
        });
        var overlaysTree = [
            {label: 'Dissolved<br /><table><tr><td style="text-align: center;"><img src="legend/Dissolved_2_ArealPenggunaanLain0.png" /></td><td>Areal Penggunaan Lain</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_HutanLindung1.png" /></td><td>Hutan Lindung</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_HutanProduksi2.png" /></td><td>Hutan Produksi</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_HutanProduksiKonversi3.png" /></td><td>Hutan Produksi Konversi</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_HutanProduksiTerbatas4.png" /></td><td>Hutan Produksi Terbatas</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_LautSungaiBadanAir5.png" /></td><td>Laut / Sungai / Badan Air</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_TamanNasional6.png" /></td><td>Taman Nasional</td></tr><tr><td style="text-align: center;"><img src="legend/Dissolved_2_7.png" /></td><td></td></tr></table>', layer: layer_Dissolved_2},
            {label: 'Clipped<br /><table><tr><td style="text-align: center;"><img src="legend/Clipped_1_ArealPenggunaanLain0.png" /></td><td>Areal Penggunaan Lain</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_HutanLindung1.png" /></td><td>Hutan Lindung</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_HutanProduksi2.png" /></td><td>Hutan Produksi</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_HutanProduksiKonversi3.png" /></td><td>Hutan Produksi Konversi</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_HutanProduksiTerbatas4.png" /></td><td>Hutan Produksi Terbatas</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_LautSungaiBadanAir5.png" /></td><td>Laut / Sungai / Badan Air</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_TamanNasional6.png" /></td><td>Taman Nasional</td></tr><tr><td style="text-align: center;"><img src="legend/Clipped_1_7.png" /></td><td></td></tr></table>', layer: layer_Clipped_1},
            {label: "Google Maps", layer: layer_GoogleMaps_0, radioGroup: 'bm' },]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: false, 
        });
        lay.addTo(map);
		document.addEventListener("DOMContentLoaded", function() {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height 
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
			// apply new Layers List height if toggle layerstree
			if (controlLayersElement) {
				controlLayersElement.addEventListener('click', function(event) {
					var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
					if (toggleLayerHeaderPointer) {
						newLayersListHeight();
					}
				});
			}
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }  
        });       
        setBounds();
        var i = 0;
        layer_Clipped_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Keterangan'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Keterangan']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Clipped_1'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Dissolved_2.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['kecamata'] !== null?String('<div style="color: #323232; font-size: 10pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['kecamata']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Dissolved_2'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        resetLabels([layer_Clipped_1,layer_Dissolved_2]);
        map.on("zoomend", function(){
            resetLabels([layer_Clipped_1,layer_Dissolved_2]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_Clipped_1,layer_Dissolved_2]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_Clipped_1,layer_Dissolved_2]);
        });
        </script>
        <div id="about-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>Tentang Website Ini</h2>
                <p>Website GIS ini dibuat untuk memenuhi tugas akhir mata kuliah Sistem Informasi Geografis dengan memasukkan Peta Kawasan Hutan Kabupaten Pasangkayu yang berada di Provinsi Sulawesi Barat</p>
                <ul>
                    <li><strong>Nama Mahasiswa:</strong> <a href="https://aidilham21.github.io/CV-aidil/" target="_blank">Muh. Aidil Ilham</a></li>
                    <li><strong>Dosen Pengampu:</strong> Affan Ray Mahardika</li>
                </ul>
            </div>
        </div>
        <div id="legend-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>Legenda Peta</h2>
                <img src="images/legend_layout.png" alt="Legenda Peta Kawasan Hutan">
                <a href="images/legend_layout.png" download="Legenda_Peta_Pasangkayu.png" class="download-btn">
                    <i class="fas fa-download"></i> Download Gambar
                </a>
            </div>
        </div>
        <script>
            // Get the legend modal
            var legendModal = document.getElementById("legend-modal");
            var legendBtn = document.getElementById("legend-btn");
            var legendCloseBtn = legendModal.getElementsByClassName("close-btn")[0];

            legendBtn.onclick = function() {
                legendModal.style.display = "block";
            }

            legendCloseBtn.onclick = function() {
                legendModal.style.display = "none";
            }

            // About modal (existing code)
            // Get the modal
            var modal = document.getElementById("about-modal");

            // Get the button that opens the modal
            var btn = document.getElementById("about-btn");

            // Get the <span> element that closes the modal
            var span = modal.getElementsByClassName("close-btn")[0];

            // When the user clicks the button, open the modal 
            btn.onclick = function() {
              modal.style.display = "block";
            }

            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
              modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              }
              // Close legend modal if clicked outside
              if (event.target == legendModal) {
                legendModal.style.display = "none";
              }
            }
        </script>
    </body>
</html>
